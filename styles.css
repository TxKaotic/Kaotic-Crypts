:root {
      --bg: #0b0f1a;            /* Deep night */
      --bg-2: #0f1526;          /* Panel */
      --accent: #ffcb6b;        /* Gold */
      --accent-2: #8ab4f8;      /* Ice blue */
      --hp: #ff6b6b;            /* Heart red */
      --mp: #6b9aff;            /* Mana blue */
      --ok: #78e08f;            /* Success */
      --warn: #f6b93b;          /* Warning */
      --danger: #e55039;        /* Danger */
      --text: #e7e7e7;          /* Primary text */
      --muted: #9aa0a6;         /* Muted text */
      --card: #121933;          /* Card bg */
      --grid: #1b2550;          /* Map grid lines */
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 16px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 600px at 50% -20%, #16203f 0%, var(--bg) 55%);
      color: var(--text);
      font-family: 'Press Start 2P', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
      letter-spacing: .25px;
    }

    /* Subtle CRT/scanline vibe */
    body::before {
      content: "";
      position: fixed; inset: 0; pointer-events: none;
      background:
        repeating-linear-gradient( to bottom, rgba(255,255,255,.035), rgba(255,255,255,.035) 1px, transparent 1px, transparent 3px );
      mix-blend-mode: soft-light; opacity: .15;
    }

    .container { max-width: 1100px; margin: 24px auto; padding: 16px; }

    .header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 16px; }
    .title { display: flex; flex-direction: column; gap: 6px; }
    h1 { margin: 0; font-size: clamp(18px, 2.8vw, 30px); text-shadow: 0 2px 0 #000, 0 0 30px rgba(255,203,107,.25); }
    .subtitle { color: var(--muted); font-size: clamp(10px, 1.8vw, 12px); }

    .controls { display: flex; gap: 8px; flex-wrap: wrap; }

    button {
      appearance: none; border: 0; cursor: pointer;
      padding: 10px 14px; border-radius: 999px; font: inherit;
      background: linear-gradient(180deg, #243164, #141a35);
      color: var(--text); box-shadow: var(--shadow);
      border: 1px solid #2b3a7a;
      transition: transform .05s ease, filter .2s ease, box-shadow .2s ease;
    }
    button:hover { filter: brightness(1.08) saturate(1.1); }
    button:active { transform: translateY(1px) scale(.995); }
    .btn-accent { background: linear-gradient(180deg, #ffd76e, #ffb703); color: #2b2411; border-color: #c98d0b; }
    .btn-danger { background: linear-gradient(180deg, #ff7a7a, #e84118); border-color: #881a0c; }
    .btn-ghost  { background: transparent; border: 1px dashed #3e4a7d; }

    .grid { display: grid; gap: 14px; grid-template-columns: 320px 1fr; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    .card { background: linear-gradient(180deg, var(--card), #101633); border: 1px solid #1e2a5d; border-radius: var(--radius); box-shadow: var(--shadow); }
    .card .card-h { padding: 14px 16px; border-bottom: 1px solid #1e2a5d; display: flex; align-items: center; justify-content: space-between; gap: 8px; border-top-left-radius: var(--radius); border-top-right-radius: var(--radius); background: linear-gradient(180deg, #1b2550, #131a3a); }
    .card .card-b { padding: 16px; }

    /* Status */
    .stats { display: grid; gap: 12px; grid-template-columns: 1fr 1fr; }
    .stat { display: grid; gap: 8px; }
    .bar { position: relative; height: 14px; background: #0a0f24; border-radius: 999px; border: 1px solid #1b2550; overflow: hidden; }
    .bar > span { position: absolute; inset: 0 0 0 0; width: var(--val, 0%); }
    .hp  { background: linear-gradient(90deg, #ffb3b3, var(--hp)); }
    .xp  { background: linear-gradient(90deg, #ffeaa7, #fdcb6e); }

    .row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .pill { padding: 6px 10px; border-radius: 999px; border: 1px solid #2b3a7a; background: #0f1636; color: var(--accent-2); font-size: 11px; }

    /* Map */
    .map { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; padding-top: 4px; }
    .cell { aspect-ratio: 1/1; border-radius: 6px; border: 1px solid var(--grid); background: #0b1130; position: relative; overflow: hidden; }
    .cell.discovered { background: #131a3f; }
    .cell.player::after { content: "⚔️"; position: absolute; inset: 0; display: grid; place-items: center; color: var(--accent); text-shadow: 0 0 12px rgba(255,203,107,.6); }
    .cell.exit::before { content: "★"; position: absolute; right: 6px; top: 4px; font-size: 10px; color: var(--ok); opacity: .85; }

    /* Log */
    .log { font-size: 12px; line-height: 1.6; height: 220px; overflow: auto; padding-right: 6px; }
    .log p { margin: 0 0 6px; color: var(--muted); }
    .log .good { color: var(--ok); }
    .log .bad { color: var(--danger); }
    .log .warn { color: var(--warn); }

    /* Actions */
    .actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    @media (max-width: 520px) { .actions { grid-template-columns: 1fr; } }

    /* Directional pad */
    .dpad { display:grid; grid-template-columns: repeat(3, 64px); gap:8px; place-items:center; margin: 4px 0 10px; }
    .dpad .spacer { width:64px; height:38px; }
    .dpad button { width:64px; }

    /* Inventory (sidebar chips) */
    .items { display: flex; flex-wrap: wrap; gap: 8px; }
    .item { display: inline-flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 10px; background: #0d1433; border: 1px solid #2b3a7a; font-size: 11px; color: #d1deff; box-shadow: var(--shadow); }
    .item small { color: var(--muted); font-size: 9px; }

    /* Footer help */
    .kbd { border:1px solid #2b3a7a; background:#0f1636; border-radius:6px; padding:2px 6px; font-size: 10px; }

    /* Tiny shimmer */
    @keyframes pulseGlow { 0%,100%{ filter: drop-shadow(0 0 0 rgba(255,203,107,0)); } 50%{ filter: drop-shadow(0 0 10px rgba(255,203,107,.35)); } }
    .title h1 { animation: pulseGlow 3s ease-in-out infinite; }

    /* ===== Dialogs ===== */
    dialog { border: 1px solid #2b3a7a; border-radius: 16px; background: linear-gradient(180deg, #16204b, #0f1636); color: var(--text); box-shadow: 0 10px 60px rgba(0,0,0,.6); }
    dialog::backdrop { background: radial-gradient(60% 60% at 50% 40%, rgba(10,14,30,.7), rgba(5,8,16,.9)); }
    .modal-h { padding: 14px 16px; border-bottom: 1px solid #263774; display:flex; align-items:center; justify-content:space-between; gap:10px; background: linear-gradient(180deg, #1b2550, #131a3a); border-top-left-radius: 16px; border-top-right-radius: 16px; }
    .modal-b { padding: 16px; }
    .modal-actions { display:flex; gap:8px; flex-wrap:wrap; }
    .combat-log { font-size: 12px; max-height: 240px; overflow:auto; }

    /* === Weapon glimmer overlay === */
    #fx { position: fixed; inset: 0; pointer-events: none; opacity: 0; mix-blend-mode: screen; z-index: 9999;
      background:
        radial-gradient(50% 40% at 50% 40%, rgba(255, 235, 180, .22), rgba(255, 235, 180, 0) 60%),
        repeating-conic-gradient(from 0deg, rgba(255,255,255,.16) 0deg 10deg, rgba(255,255,255,0) 10deg 20deg);
    }
    #fx.glimmer { animation: glimmerFlash 900ms ease forwards; }
    @keyframes glimmerFlash { 0% { opacity: 0; } 15% { opacity: 1; } 100% { opacity: 0; } }